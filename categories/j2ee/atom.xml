<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: J2EE | Programming Notes]]></title>
  <link href="http://test.paykin.info/categories/j2ee/atom.xml" rel="self"/>
  <link href="http://test.paykin.info/"/>
  <updated>2013-09-26T19:51:20+03:00</updated>
  <id>http://test.paykin.info/</id>
  <author>
    <name><![CDATA[Dmitry]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Integrating HornetQ with Camel and Spring]]></title>
    <link href="http://test.paykin.info/hornetq-camel-spring/"/>
    <updated>2012-12-13T00:00:00+02:00</updated>
    <id>http://test.paykin.info/hornetq-camel-spring</id>
    <content type="html"><![CDATA[<p>Since Apache Camel have only one built-in implementation for specific JMS provider &ndash; ActiveMQ, you have to use generic org.apache.camel.component.jms.JmsConfiguration.
In order to work with HornetQ with Camel and Spring first you have to add HornetQ dependencies to Maven pom.xml:
``` xml
&lt;dependency&gt;</p>

<pre><code>&amp;lt;groupId&amp;gt;org.hornetq&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;hornetq-jms&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;${hornetq.version}&amp;lt;/version&amp;gt;
</code></pre>

<p>&lt;/dependency&gt;
&lt;dependency&gt;</p>

<pre><code>&amp;lt;groupId&amp;gt;org.hornetq&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;hornetq-jms-client&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;${hornetq.version}&amp;lt;/version&amp;gt;
</code></pre>

<p>&lt;/dependency&gt;
&lt;dependency&gt;</p>

<pre><code>&amp;lt;groupId&amp;gt;org.hornetq&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;hornetq-core-client&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;${hornetq.version}&amp;lt;/version&amp;gt;
</code></pre>

<p>&lt;/dependency&gt;
&lt;dependency&gt;</p>

<pre><code>&amp;lt;groupId&amp;gt;org.jboss.netty&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;netty&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;3.2.7.Final&amp;lt;/version&amp;gt;
</code></pre>

<p>&lt;/dependency&gt;
<code>
After that modify your spring.xml. Here is an example:
&amp;lt;!--more--&amp;gt;
</code> xml
&lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;UTF-8&rdquo;?&gt;
&lt;beans xmlns=&ldquo;<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>&rdquo;</p>

<pre><code>   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"&amp;gt;
&amp;lt;bean id="hornetqServerLocatorFactory" class="com.example.HornetqServerLocatorFactory" /&amp;gt;
&amp;lt;bean id="hornetqServerLocator" factory-bean="hornetqServerLocatorFactory" factory-method="createServerLocator"/&amp;gt;
&amp;lt;bean id="hornetqJmsConnectionFactory" class="org.hornetq.jms.client.HornetQJMSConnectionFactory"&amp;gt;
    &amp;lt;constructor-arg name="serverLocator" ref="hornetqServerLocator"/&amp;gt;
&amp;lt;/bean&amp;gt;
&amp;lt;bean id="hornetqJmsConfig" class="org.apache.camel.component.jms.JmsConfiguration"&amp;gt;
    &amp;lt;property name="connectionFactory" ref="hornetqJmsConnectionFactory"/&amp;gt;
    &amp;lt;property name="transacted" value="false"/&amp;gt;
    &amp;lt;property name="requestTimeout" value="60000"/&amp;gt;
&amp;lt;/bean&amp;gt;
&amp;lt;bean id="hornetq" class="org.apache.camel.component.jms.JmsComponent"&amp;gt;
    &amp;lt;property name="configuration" ref="hornetqJmsConfig"/&amp;gt;
&amp;lt;/bean&amp;gt;
</code></pre>

<p>&lt;/beans&gt;
<code>
And the last thing is to write your implementation of HornetqServerLocatorFactory. If you wish to configure HornetQ host and port from spring.xml, you can easily do it - just put them as members of the class and inject them via Spring.xml.
</code> java</p>

<pre><code>package com.example;
import java.util.HashMap;
import java.util.Map;
import org.hornetq.api.core.TransportConfiguration;
import org.hornetq.api.core.client.HornetQClient;
import org.hornetq.api.core.client.ServerLocator;
import org.hornetq.core.remoting.impl.netty.NettyConnectorFactory;
import org.springframework.beans.factory.annotation.Configurable;
@Configurable
public class HornetqServerLocatorFactory {
    public ServerLocator createServerLocator() {
        final Map&amp;lt;String, Object&amp;gt; connectionParams = new HashMap&amp;lt;String, Object&amp;gt;();
        connectionParams.put( "port", "hornetq-host.com" );
        connectionParams.put( "host", 5900 );
        final TransportConfiguration transportConfiguration = new TransportConfiguration( NettyConnectorFactory.class.getName(), connectionParams );
        final ServerLocator serverLocator = HornetQClient.createServerLocatorWithoutHA( new TransportConfiguration[] { transportConfiguration } );
        return serverLocator;
    }
}
</code></pre>

<p>```
That&rsquo;s it</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Create datasource programmatically on JBoss 7]]></title>
    <link href="http://test.paykin.info/add-datasource-programaticaly-cli-jboss-7/"/>
    <updated>2011-11-24T00:00:00+02:00</updated>
    <id>http://test.paykin.info/add-datasource-programaticaly-cli-jboss-7</id>
    <content type="html"><![CDATA[<p>In order to create new datasource programmatically on JBoss 7 without restart (on the fly) from Java you can use CLI Java API. You have to include jboss-as-controller-client to your project dependencies:
``` xml
&lt;dependency&gt;</p>

<pre><code>&amp;lt;groupId&amp;gt;org.jboss.as&amp;lt;/groupId&amp;gt;
&amp;lt;artifactId&amp;gt;jboss-as-controller-client&amp;lt;/artifactId&amp;gt;
&amp;lt;version&amp;gt;7.0.2.Final&amp;lt;/version&amp;gt;
</code></pre>

<p>&lt;/dependency&gt;
<code>
The following example creates new datasource:
&amp;lt;!--more--&amp;gt;
</code> java</p>

<pre><code>public void createDatasource() throws Exception{
    ModelNode request = new ModelNode();
    request.get(ClientConstants.OP).set(ClientConstants.ADD);
    request.get(ClientConstants.OP_ADDR).add("subsystem",
            "datasources");
    request.get(ClientConstants.OP_ADDR).add("data-source",
            "java:jboss/datasources/NewDatasource");
    request.get("jndi-name").set("java:jboss/datasources/NewDatasource");
    request.get("connection-url").set("jdbc:as400://1.2.3.4/SCHEME");
    request.get("driver-class").set("com.ibm.as400.access.AS400JDBCDriver");
    request.get("driver-name").set("jt400.jar");
    request.get("user-name").set("username");
    request.get("password").set("password");
    request.get("pool-name").set("pool_NewDatasource");
    ModelControllerClient client = ModelControllerClient.Factory.create(
            InetAddress.getByName("127.0.0.1"), 9999);
    client.execute(new OperationBuilder(request).build());
}
</code></pre>

<p><code>
If you want to check if the datasource already exists, consider following snippet:
</code> java</p>

<pre><code>public boolean checkIfDatasourceExists() throws Exception {
    ModelNode request = new ModelNode();
    request.get(ClientConstants.OP).set("read-resource");
    request.get("recursive").set(false);
    request.get(ClientConstants.OP_ADDR).add("subsystem", "datasources");
    ModelControllerClient client = ModelControllerClient.Factory.create(
            InetAddress.getByName("127.0.0.1"), 9999);
    ModelNode responce = client.execute(new OperationBuilder(request).build());
    ModelNode datasources = responce.get(ClientConstants.RESULT).get("data-source");
    if (datasources.isDefined()) {
        for (ModelNode dataSource : datasources.asList()) {
            String dataSourceName = dataSource.asProperty().getName();
            if (dataSourceName.equals("java:jboss/datasources/NewDatasource")) {
                return true;
            }
        }
    }
    return false;
}
</code></pre>

<p>```
The examples have the same effect as trying to add datasource from Jboss Administration console.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Forcing JBoss 7 to apply changes to JSP's immediately]]></title>
    <link href="http://test.paykin.info/jboss-7-changes-jsp/"/>
    <updated>2011-10-27T00:00:00+02:00</updated>
    <id>http://test.paykin.info/jboss-7-changes-jsp</id>
    <content type="html"><![CDATA[<p>JBoss AS 7 by default do not reflect any changes to JSP files in WAR deployment. So, during application development you have to redeploy WAR or restart JBoss. In order to change this behaviour it is necessary to change section of  in  so it looks like:
``` xml</p>

<pre><code>&amp;lt;configuration&amp;gt;
    &amp;lt;jsp-configuration development="true"/&amp;gt;
&amp;lt;/configuration&amp;gt;
...
</code></pre>

<p>```
And now JBoss behaves as you expect it in development mode: all changes to JSP files are loaded automatically as soon as you change the JSP file.</p>
]]></content>
  </entry>
  
</feed>
